# Mariposa House v1.5 実装状況レポート

作成日: 2026年2月1日

---

## 1. 実装計画概要

v1.0 から v1.5 へのアップグレード。主な目標：
- バイリンガル対応（日本語/英語）
- お問い合わせフォームの実際の送信機能
- プライバシーポリシーページ追加
- デザイン改善
- SEO 強化
- アクセシビリティ改善

---

## 2. 完了した実装

### Phase 1: バイリンガル対応 ✅ 完了

| 項目 | ファイル | 状態 |
|------|----------|------|
| next-intl インストール | package.json | ✅ |
| ロケール設定 | src/i18n/config.ts | ✅ |
| リクエスト設定 | src/i18n/request.ts | ✅ |
| ミドルウェア | src/middleware.ts | ✅ |
| Next.js設定更新 | next.config.ts | ✅ |
| 日本語翻訳 | messages/ja.json | ✅ |
| 英語翻訳 | messages/en.json | ✅ |

**URL構造:**
- 日本語: `/ja`, `/ja/about`, `/ja/worship`, etc.
- 英語: `/en`, `/en/about`, `/en/worship`, etc.

### Phase 2: ページ構造の変更 ✅ 完了

**新しいディレクトリ構造:**
```
src/app/
├── globals.css
├── favicon.ico
└── [locale]/
    ├── layout.tsx      ✅ 作成済み
    ├── page.tsx        ✅ 作成済み（ホーム）
    ├── about/
    │   └── page.tsx    ✅ 作成済み
    ├── worship/
    │   └── page.tsx    ✅ 作成済み
    ├── news/
    │   ├── page.tsx    ✅ 作成済み
    │   └── [slug]/
    │       └── page.tsx ✅ 作成済み
    ├── contact/
    │   └── page.tsx    ✅ 作成済み
    └── privacy/
        └── page.tsx    ✅ 作成済み（新規）
```

### Phase 3: コンポーネント更新 ✅ 完了

| コンポーネント | 更新内容 | 状態 |
|--------------|----------|------|
| Header.tsx | 翻訳対応、言語切替機能、スクロール時ブラー効果 | ✅ |
| Footer.tsx | 翻訳対応、ロケール対応リンク | ✅ |

### Phase 4: フォーム機能 ✅ 完了

| 項目 | ファイル | 状態 |
|------|----------|------|
| フォーム送信フック | src/hooks/useContactForm.ts | ✅ |
| Contact ページ更新 | src/app/[locale]/contact/page.tsx | ✅ |

**Formspree 設定方法:**
1. https://formspree.io でアカウント作成
2. フォームを作成してIDを取得
3. `.env.local` に追加: `NEXT_PUBLIC_FORMSPREE_ID=your-form-id`

※ 現在は Formspree ID が未設定の場合、コンソールにログ出力してシミュレーション動作

---

## 3. 未完了の実装

### Phase 5: デザイン改善 ⏳ 未着手

**globals.css に追加予定:**

```css
/* 1. カード効果の改善 */
.card {
  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
}
.card:hover {
  box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  transform: translateY(-4px);
}

/* 2. 聖句引用スタイル */
.scripture-quote {
  position: relative;
  padding: 2rem 3rem;
  background: var(--gray-50);
  border-left: 3px solid var(--gray-300);
}
.scripture-quote::before {
  content: '"';
  font-size: 4rem;
  color: var(--gray-200);
}

/* 3. フォーカスリング（アクセシビリティ） */
*:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

/* 4. スキップリンク */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--primary);
  color: white;
  padding: 8px;
  z-index: 100;
}
.skip-link:focus {
  top: 0;
}
```

### Phase 6: SEO 強化 ⏳ 未着手

**必要な作業:**

1. **Schema.org 構造化データ**
   - `src/components/ChurchSchema.tsx` を作成
   - Church 型の JSON-LD を出力

2. **サイトマップ生成**
   - `npm install next-sitemap`
   - `next-sitemap.config.js` を作成
   - `package.json` に postbuild スクリプト追加

3. **robots.txt**
   - next-sitemap で自動生成

### Phase 7: アクセシビリティ改善 ⏳ 未着手

**必要な作業:**
- フォーカスリングスタイルを globals.css に追加
- スキップリンクは layout.tsx に追加済み
- aria-label は Header.tsx に追加済み

---

## 4. 作成されたファイル一覧

### 新規作成ファイル
```
website/
├── messages/
│   ├── ja.json                 # 日本語翻訳
│   └── en.json                 # 英語翻訳
├── src/
│   ├── i18n/
│   │   ├── config.ts           # ロケール設定
│   │   └── request.ts          # next-intl 設定
│   ├── middleware.ts           # ロケールルーティング
│   ├── hooks/
│   │   └── useContactForm.ts   # フォーム送信フック
│   └── app/
│       └── [locale]/
│           ├── layout.tsx
│           ├── page.tsx
│           ├── about/page.tsx
│           ├── worship/page.tsx
│           ├── news/page.tsx
│           ├── news/[slug]/page.tsx
│           ├── contact/page.tsx
│           └── privacy/page.tsx  # 新規ページ
```

### 更新されたファイル
```
website/
├── next.config.ts              # next-intl プラグイン追加
├── package.json                # next-intl 依存関係追加
└── src/
    └── components/
        ├── Header.tsx          # 翻訳対応、言語切替、ブラー効果
        └── Footer.tsx          # 翻訳対応
```

---

## 5. 旧ファイルの扱い

**削除が必要なファイル（[locale]版に移行済み）:**
```
src/app/
├── layout.tsx          # → [locale]/layout.tsx に移行
├── page.tsx            # → [locale]/page.tsx に移行
├── about/page.tsx      # → [locale]/about/page.tsx に移行
├── worship/page.tsx    # → [locale]/worship/page.tsx に移行
├── news/page.tsx       # → [locale]/news/page.tsx に移行
├── news/[slug]/page.tsx # → [locale]/news/[slug]/page.tsx に移行
├── contact/page.tsx    # → [locale]/contact/page.tsx に移行
├── welcome/page.tsx    # 不要（/about にリダイレクト）
└── faith/page.tsx      # 不要（/worship にリダイレクト）
```

---

## 6. ビルド前の確認事項

### 必須
- [ ] 旧ページファイルの削除
- [ ] `npm run build` の実行
- [ ] 全ページの動作確認（/ja, /en）
- [ ] 言語切替の動作確認
- [ ] フォーム送信の動作確認

### 推奨
- [ ] Lighthouse でパフォーマンス確認
- [ ] モバイル表示の確認
- [ ] SEO メタタグの確認

---

## 7. 環境変数

**.env.local に設定が必要:**
```env
# Formspree フォーム ID（お問い合わせ送信用）
NEXT_PUBLIC_FORMSPREE_ID=your-form-id

# WordPress API（ニュース機能用、オプション）
WORDPRESS_API_URL=https://your-wordpress-site.com/wp-json
USE_MOCK_DATA=true
```

---

## 8. 次のステップ

1. **現状のビルド確認**
   - 旧ファイルを削除
   - `npm run build` を実行
   - エラーがあれば修正

2. **デザイン改善の実装**
   - globals.css の更新

3. **SEO 強化**
   - Schema.org の追加
   - サイトマップ生成設定

4. **最終テスト**
   - 全機能の動作確認
   - Lighthouse 確認

5. **Git コミット & プッシュ**
   - v1.5 としてタグ付け

---

*このドキュメントは実装の中間状態を記録しています。*
